---
layout: template
menu : tutorial
title : Data processing pipeline
---

<h2>1. Introduction</h2>

        <p>We all love the power and elegance of the unix pipeline concept.
            In this tutorial, you will see that Easy Batch allows you to bring this power to the java world.
            You will build a unix like data processing pipeline on tweets. Here is our tweets data source:</p>

<div class="bs-callout bs-callout-code">
    <h5>tweets.csv</h5>
<pre><code>1,foo,easy batch rocks #EasyBatch
2,bar,@foo I do confirm :-)
</code></pre>
</div>

        <p>The goal is to implement the equivalent of the following unix command:</p>

<div class="bs-callout bs-callout-code">
<pre><code>cat tweets.csv | grep #EasyBatch | cut -d',' f3 | wc</code></pre>
</div>

        <p>This will count the number of words in tweets containing the hash tag <code>#EasyBatch</code>.</p>

        <p>Let's get your hands dirty!</p>

<h2>2. Reading tweets</h2>

        <p>As in previous tutorial, we will use the <code><em>FlatFileRecordReader</em></code> to read tweets from the <code>tweets.csv</code> file:</p>

<div class="bs-callout bs-callout-code">
<pre><code>Engine engine = new EngineBuilder()
    <strong>.reader(new FlatFileRecordReader(new File("tweets.csv")))</strong>
    .build();</code></pre>
</div>

        <p>This reader will produce <code><em>StringRecord</em></code> with string payloads. We will implement several processor to operate on these strings.</p>

<h2>3. Grepping tweets</h2>

        <p>The <code>RecordFilter</code> API is a perfect candidate to implement the <code>grep</code> command.</p>
        <p>Easy Batch provides a built-in filter that mimics the <code>grep</code> command, it is called <code><em>GrepFilter</em></code>.</p>
        <p>This filter uses a pattern and filters string records if their content does not contain the pattern:</p>

<div class="bs-callout bs-callout-code">
<pre><code>Engine engine = new EngineBuilder()
    .reader(new FlatFileRecordReader(new File("tweets.csv")))
    <strong>.filter(new GrepFilter("#EasyBatch"))</strong>
    .build();</code></pre>
</div>

<h2>4. Splitting tweets</h2>

<p>The next step is to implement the command <code><em>cut -d',' f3</em></code>. Here is a processor that does the trick:</p>

<div class="bs-callout bs-callout-code">
    <h5>CutProcessor.java</h5>
<pre><code class="java">public class CutProcessor implements RecordProcessor&lt;StringRecord, String&gt; {

    private String delimiter;

    private int fieldNumber;

    public CutProcessor(String delimiter, int fieldNumber) {
        this.delimiter = delimiter;
        this.fieldNumber = fieldNumber;
    }

    @Override
    public String processRecord(StringRecord record) throws Exception {
        return record.getPayload().split(delimiter)[fieldNumber];
    }

}</code></pre>

</div>

<p>No magic, it splits the input record using the delimiter and returns the desired field.
    Note that error handling is not implemented for simplicity sake <i class="fa fa-smile-o"></i>.</p>

<div class="bs-callout bs-callout-warning">
    <h5><i class="fa fa-info-circle"></i> Heads up!</h5>
    <p>Note that the type of output object is different from the type of input object. The record can be transformed
        during its journey in the processing pipeline.</p>

</div>

<h2>5. Counting words</h2>

<p>The next step is to implement the <code>wc</code> command. Here is a processor that does the trick:</p>

<div class="bs-callout bs-callout-code">
    <h5>WordCountProcessor.java</h5>
<pre><code class="java">public class WordCountProcessor implements ComputationalRecordProcessor&lt;String, String, Integer&gt; {

    private Integer count = 0;

    @Override
    public String processRecord(String record) throws Exception {
        count += record.split(" ").length;
        return record;
    }

    @Override
    public Integer getComputationResult() {
    return count;
    }

}</code></pre>
</div>

<p>Another time, no magic, simply count the number of words in the input string.</p>
        <p>Note that this is a <em>computational</em> processor since it does some computation.
            It should be placed at the end of the pipeline.</p>

<h2>7. Putting it all together</h2>

<p>To launch the tutorial, we will use the following class:<p>

<div class="bs-callout bs-callout-code">
<pre><code class="java">public class Launcher {

    public static void main(String[] args) throws Exception {

        // Build a batch engine
        Engine engine = new EngineBuilder()
            .reader(new FlatFileRecordReader(new File(args[0])))
            .filter(new GrepFilter("#EasyBatch"))
            .processor(new CutProcessor(",", 2))
            .processor(new WordCountProcessor())
            .build();

        // Run the batch engine
        Report report = engine.call();

        // Print the batch execution report
        System.out.println("the number of words in tweets containing #EasyBatch = "
                + report.getBatchResult());

    }
}</code></pre>
</div>

<p>To run the tutorial, proceed as follow:</p>
<div class="bs-callout bs-callout-code">
<pre><code>$>git clone https://github.com/benas/easy-batch.git
$>cd easy-batch
$>mvn install
$>cd easybatch-tutorials
$>mvn exec:java -PrunPipelineTutorial
</code></pre>
</div>

        <p>You should see the following output:</p>

<div class="bs-callout bs-callout-code">
<pre><code>INFO: Initializing easy batch engine
INFO: Data source: tweets.csv
INFO: Strict mode: false
INFO: Total records = 3
INFO: easy batch engine is running...
INFO: Record #1 [Record{number=1, payload='id,user,message'}] has been filtered.
INFO: Record #3 [Record{number=3, payload='2,bar,@foo I do confirm :-)'}] has been filtered.
the number of words in tweets containing #EasyBatch = 4
INFO: Shutting down easy batch engine</code></pre>
</div>

<h2 id="8">8. Summary</h2>

<p>In this tutorial, you have learned how to build a unix like data processing pipeline using Easy Batch.
    This is actually a sort of filter-map-reduce implementation.
    All the power is now in your hands to imagine and build all sorts of pipeline, easily!</p>

<h2 id="9">9. What's next?</h2>

<p>That was all for basic tutorials, you can now move on to the next level to see how to build real world enterprise
    batch applications using Easy Batch.</p>

<nav>
    <ul class="pager">
        <li class="previous"><a href="./key-apis.html"><span aria-hidden="true">&larr;</span> Key APIs tutorial</a></li>
        <li class="next"><a href="./pipeline.html">Loading data into a database <span aria-hidden="true">&rarr;</span></a></li>
    </ul>
</nav>