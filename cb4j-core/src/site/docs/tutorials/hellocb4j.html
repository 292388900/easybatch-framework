<!DOCTYPE html>

<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta charset="utf-8">
    <title>CB4J</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="benas">

    <link href="../resources/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }
    </style>
    <link href="../resources/css/bootstrap-responsive.min.css" rel="stylesheet">

    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>

</head>

<body>

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="../index.html">CB4J</a>
            <div class="nav-collapse collapse">
                <p class="navbar-text pull-right">
                    <a href="https://github.com/benas/cb4j" class="navbar-link">Fork me on Github</a>
                </p>
                <ul class="nav">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../about.html">About</a></li>
                    <li class="dropdown">
                        <a id="documentation" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">Documentation<b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="documentation">
                            <li><a href="../documentation/gettingStarted.html">Getting started</a></li>
                            <li><a href="../documentation/architecture.html">Architecture</a></li>
                            <li><a href="../documentation/userGuide.html">User Guide</a></li>
                            <li><a href="../javadoc/index.html">API Javadoc</a></li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a id="tutorials" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="tutorials">
                            <li><a href="hellocb4j.html">Hello CB4J!</a></li>
                            <li><a href="customers.html">Customers ETL</a></li>
                            <li><a href="products.html">Product Statistics</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">

        <div class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                    <li class="nav-header">About CB4J</li>
                    <li><a href="../about.html">Overview</a></li>
                    <li><a href="../releaseNotes.html">Release notes</a></li>
                    <li class="nav-header">Documentation</li>
                    <li><a href="../documentation/gettingStarted.html">Getting started</a></li>
                    <li><a href="../documentation/architecture.html">Architecture</a></li>
                    <li><a href="../documentation/userGuide.html">User Guide</a></li>
                    <li><a href="../javadoc/index.html">API Javadoc</a></li>
                    <li class="nav-header">Tutorials</li>
                    <li class="active"><a href="hellocb4j.html">Hello CB4J!</a></li>
                    <li><a href="customers.html">Customers ETL</a></li>
                    <li><a href="products.html">Product Statistics</a></li>
                </ul>
            </div>
        </div>

        <div class="span9">

            <div class="header">
                <h1>Hello CB4J Tutorial</h1>
                <h2></h2>
            </div>

            <div class="row-fluid">

                <h3>Description</h3>
                <p>This tutorial is a Hello world example of using CB4J. We will process a simple CSV file containing persons records to generate greetings.
                   The input file named "<strong>persons.csv</strong>" has the following format:</p>
<pre>
sequence,name
1,John
2,Harry,Smith
x,Ben
</pre>
                <p>Each record is composed of 2 fields :
                <ul>
                    <li>a sequence number : must be a numeric value</li>
                    <li>a person name</li>
                </ul>
                </p>
                <p>The processing logic should generate a greeting message for each record.
                   For example, for the record <code>1,john</code>, the batch should generate and print to the console the follwoing greeting message : <code>Hi John! your sequence number is 1.</code></p>
                <p></p>

                <h3>Expected results</h3>
                <p>For the sample file listed above, we expect the following results :</p>
                <ul>
                    <li>Record #1 : this is a header record containing field names, it should be skipped</li>
                    <li>Record #2 : this record is well formed and has valid data, it should be processed</li>
                    <li>Record #3 : this record is not well formed. In fact, it has 3 fields instead of 2 as expected, it should be ignored</li>
                    <li>Record #4 : this record is well formed, but has an invalid value "x" for the first field which must be numeric. Hence, this record should be rejected</li>
                </ul>
                <h3>Implementation using CB4J</h3>
                <h4>Configuration</h4>
                <p>First, we need to configure CB4J with CSV parameters. By default, CB4J uses the comma ',' character as separator which is fine for this tutorial, so no configuration is needed for field separator.</p>
                <p>Nevertheless, we have to specify the path of input file, the record size and the skipHeader parameters. This is done as follows :</p>
<pre>
Properties configurationProperties = new Properties();
configurationProperties.setProperty("input.data.path","/data/cb4j/cb4j-tutorials/src/main/resources/persons.csv");
configurationProperties.setProperty("input.record.size","2");
configurationProperties.setProperty("input.data.skipHeader", "true");
</pre>
                <h4>Validation data</h4>
                <p>In this tutorial, the first field should be numeric. To ensure this constraint, we have to register the built-in <code>NumericFieldValidator</code> for the first field. This can be done as follows:</p>
<pre>
batchConfiguration.registerFieldValidator(1, new NumericFieldValidator());
</pre>

                <h4>Mapping records to java objects</h4>
                <p>To work with an object view of CSV records, we will create a simple POJO representing a greeting. The <code>Greeting</code> class is defined as follows:</p>
<pre>
public class Greeting {

private long sequence;

private String name;

// Getters and Setters

public String getGreetingMessage() {
    return "Hi " + name + "! Your sequence number is " + sequence;
}
}
</pre>

                <p>To map CSV records to <code>Greeting</code> objects, we have to provide an implementation of the <code>RecordMapper&lt;T&gt;</code> interface as follow :</p>
<pre>
public class GreetingMapper implements RecordMapper&lt;Greeting&gt; {

    public Greeting mapRecord(Record record) throws RecordMappingException {

    Greeting greeting = new Greeting();

    greeting.setSequence(Long.valueOf(record.getFieldContentByIndex(0)));
    greeting.setName(record.getFieldContentByIndex(1));

    return greeting;

    }
    }
</pre>

                <p>To register the record mapper implementation, use the following snippet :</p>
<pre>
batchConfiguration.registerRecordMapper(new GreetingMapper());
</pre>

                <h4>Process records</h4>
                <p>At this point, we have validated and mapped CSV records to <code>Greeting</code> objects. It is time to define the business processing logic which consists in this tutorial of printing to the console a greeting message for each person. For that to be done, we implement the <code>RecordProcessor&lt;T&gt;</code> as follows:</p>
<pre>
public class GreetingProcessor implements RecordProcessor&lt;Greeting&gt; {

    public void preProcessRecord(Greeting greeting) {
    //no-op
    }

    public void processRecord(Greeting greeting) {
    System.out.println(greeting.getGreetingMessage());
    }

    public void postProcessRecord(Greeting greeting) {
    //no-op
    }
    }
</pre>

                <p>Then, whe have to register this implementation to be used by CB4J to process records :</p>
<pre>
batchConfiguration.registerRecordProcessor(new GreetingProcessor());
</pre>
                <h4>Running the batch</h4>
                <p>Finally, we can initialize a batch engine instance and run the batch as follows:</p>
<pre>
BatchEngine batchEngine = new DefaultBatchEngineImpl(batchConfiguration);
BatchRunner batchRunner = new BatchRunner(batchEngine);
batchRunner.run();
</pre>

                <p>The complete source code of this tutorial is available <a href="https://github.com/benas/cb4j/tree/master/cb4j-tutorials/src/main/java/net/benas/cb4j/tutorials/helloworld">here</a>.
                To run the tutorial with maven, launch the following command in the <code>cb4j/cb4j-tutorials</code> directory :</p>

<pre>
mvn clean install -PrunHelloWorldTutorial
</pre>
                <p>If everything is ok, you should see the following output in the console :</p>

<pre>
[CB4J : INFO] Configuration started at : Mon Sep 03 22:29:07 CEST 2012
[CB4J : WARNING] No encoding specified for input data, using system default encoding : Cp1252
[CB4J : WARNING] No field separator specified, using default : ','
[CB4J : WARNING] No log file specified for ignored records, using default : /data/cb4j/cb4j-tutorials/src/main/resources/persons-ignored.log
[CB4J : WARNING] No log file specified for rejected records, using default : /data/cb4j/cb4j-tutorials/src/main/resources/persons-rejected.log
[CB4J : INFO] Configuration successful
[CB4J : INFO] Configuration parameters details : {input.data.skipHeader=true, input.record.size=2, input.data.path=/data/cb4j/cb4j-tutorials/src/main/resources/persons.csv}
[CB4J : INFO] Initializing batch
Hi John! Your sequence number is 1
[CB4J : INFO] finalizing batch
[CB4J : INFO] CB4J report :
[CB4J : INFO] Start time = Mon Sep 03 22:29:07 CEST 2012
[CB4J : INFO] End time = Mon Sep 03 22:29:07 CEST 2012
[CB4J : INFO] Batch duration = 2ms
[CB4J : INFO] Total input records = 3
[CB4J : INFO] Total ignored records = 1
[CB4J : INFO] Total rejected records = 1
[CB4J : INFO] Total processed records = 1
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.795s
[INFO] Finished at: Mon Sep 03 22:29:07 CEST 2012
[INFO] Final Memory: 8M/19M
[INFO] ------------------------------------------------------------------------
</pre>
                <p>As expected, CB4J has generated a greeting message only for the valid record <code>1,John</code>. </p>

                <p>Moreover, CB4J has generated a simple report about the batch execution time, the total number of input records, ignored and rejected records.
                In addition to that, CB4J has generated two log files containing the ignored and rejected records and indicating which validation rule was violated and caused the rejection of each record. </p>

                <p>The following is the content of the ignored records log file <code>/data/cb4j/cb4j-tutorials/src/main/resources/persons-ignored.log</code> :</p>
<pre>
Record #2 [2,Harry,Smith] is ignored, Error : record size 3 not equal to expected size.
</pre>
                <p>The following is the content of the rejected records log file <code>/data/cb4j/cb4j-tutorials/src/main/resources/persons-rejected.log</code> :</p>
<pre>
Record #3 [x,Ben,] is rejected, Error : The field Field[index=1, content='x'] is not valid according to validation rule : [The field content should be a numeric value]
</pre>

            </div>

        </div>

    </div>

    <hr>

    <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>CB4J : CSV Batch processing with Java made easy!</p>
        <p>Maintained by <a href="https://github.com/benas">benas</a> at <a href="https://github.com/benas/cb4j">Github</a></p>
    </footer>

</div>

<script src="../resources/js/jquery.js"></script>
<script src="../resources/js/bootstrap.min.js"></script>

</body></html>